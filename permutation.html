<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASCON Suite: Using the ASCON SnP Permutation API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASCON Suite
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Using the ASCON SnP Permutation API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#permutation_init">Initializing and finalizing the permutation</a></li>
<li class="level1"><a href="#permutation_absorb">Absorbing data into the permutation state</a></li>
<li class="level1"><a href="#permutation_squeeze">Squeezing data out of the permutation state</a></li>
<li class="level1"><a href="#permutation_encrypt">Encrypting and decrypting with a permutation state</a></li>
<li class="level1"><a href="#permutation_suspend">Suspending use of the permutation</a></li>
<li class="level1"><a href="#permutation_copy">Copying the permutation state</a></li>
<li class="level1"><a href="#permutation_rep">State representation</a></li>
</ul>
</div>
<div class="textblock"><p>The core of the ASCON Suite of algorithms is the ASCON permutation. The <a class="el" href="permutation_8h.html#ab21c365db8b660dc1e81ddbbda00395e" title="Permutes the ASCON state with a specified number of rounds.">ascon_permute()</a> function operates on a 320-bit (40-byte) input through a number of rounds, producing a 320-bit output. The number of rounds is configurable between 1 and 12.</p>
<p>Standard ASCON modes typically use 6, 8, or 12 rounds so there are convenient macros for those values: <a class="el" href="permutation_8h.html#adea77da266b81944a3fb25826ac08dd6" title="Permutes the ASCON state with 6 rounds of the permutation.">ascon_permute6()</a>, <a class="el" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af" title="Permutes the ASCON state with 8 rounds of the permutation.">ascon_permute8()</a>, and <a class="el" href="permutation_8h.html#a132695890e3130dd42ba6eaf3f545aec" title="Permutes the ASCON state with 12 rounds of the permutation.">ascon_permute12()</a>.</p>
<p>The permutation implementations for each platform are located in the <code>src/core</code> directory. Each backend provides a "state and permutation" (SnP) interface to the rest of the library and user applications.</p>
<p>Most user applications have no need for the SnP API because they can use the relevant encryption or hashing mode from the library directly. The public SnP API is provided just in case an application has a specific requirement that isn't met by the standard modes. This page describes how to use the permutation directly should the application need to do so.</p>
<h1><a class="anchor" id="permutation_init"></a>
Initializing and finalizing the permutation</h1>
<p>The permutation API is declared in the header <a class="el" href="permutation_8h.html" title="Direct access to the ASCON permutation primitive.">permutation.h</a>, included into application code as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="permutation_8h.html">ascon/permutation.h</a>&gt;</span></div>
<div class="ttc" id="apermutation_8h_html"><div class="ttname"><a href="permutation_8h.html">permutation.h</a></div><div class="ttdoc">Direct access to the ASCON permutation primitive.</div></div>
</div><!-- fragment --><p>The 320-bit input (and output) to the permutation is held in a structure called <a class="el" href="unionascon__state__t.html" title="Structure of the internal state of the ASCON permutation.">ascon_state_t</a>. The state must be initialized before it can be used by the application:</p>
<div class="fragment"><div class="line"><a class="code" href="unionascon__state__t.html">ascon_state_t</a> <a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>;</div>
<div class="line"><a class="code" href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940">ascon_init</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="ttc" id="apermutation_8h_html_adafef02af51e197bc78bba4b4222e940"><div class="ttname"><a href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940">ascon_init</a></div><div class="ttdeci">void ascon_init(ascon_state_t *state)</div><div class="ttdoc">Initializes the words of the ASCON permutation state to zero.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00032">ascon-sliced32.c:32</a></div></div>
<div class="ttc" id="asnippets_8c_html_a11a12bb758476a291d682dac7046a3f4"><div class="ttname"><a href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a></div><div class="ttdeci">ascon_state_t state</div><div class="ttdoc">[snippet_key]</div><div class="ttdef"><b>Definition:</b> <a href="snippets_8c_source.html#l00002">snippets.c:2</a></div></div>
<div class="ttc" id="aunionascon__state__t_html"><div class="ttname"><a href="unionascon__state__t.html">ascon_state_t</a></div><div class="ttdoc">Structure of the internal state of the ASCON permutation.</div><div class="ttdef"><b>Definition:</b> <a href="permutation_8h_source.html#l00062">permutation.h:63</a></div></div>
</div><!-- fragment --><p>Initialization sets all of the bits of the ASCON state to zero.</p>
<p>Once the application is finished with the state, it must finalize it with <a class="el" href="permutation_8h.html#a3331b7366f81091a2182f215cf7fef1c" title="Frees an ASCON permutation state and attempts to destroy any sensitive material.">ascon_free()</a>:</p>
<div class="fragment"><div class="line"><a class="code" href="permutation_8h.html#a3331b7366f81091a2182f215cf7fef1c">ascon_free</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="ttc" id="apermutation_8h_html_a3331b7366f81091a2182f215cf7fef1c"><div class="ttname"><a href="permutation_8h.html#a3331b7366f81091a2182f215cf7fef1c">ascon_free</a></div><div class="ttdeci">void ascon_free(ascon_state_t *state)</div><div class="ttdoc">Frees an ASCON permutation state and attempts to destroy any sensitive material.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00042">ascon-sliced32.c:42</a></div></div>
</div><!-- fragment --><p>Finalization will attempt to destroy any sensitive material still in the "state" structure. But the compiler's optimizer may interfere with the execution order of the program and defeat the attempt. Or there may still be fragments of the sensitive material elsewhere on the stack or in registers. All we can do is a "best effort" to clean up the state given the system's constraints.</p>
<p>For buffers in your own code, use <a class="el" href="utility_8h.html#a331ff039487fd153ee170a600cf4850b" title="Cleans a buffer that contains sensitive material.">ascon_clean()</a> to destroy sensitive material when you no longer need it. The same caveats about the compiler apply.</p>
<h1><a class="anchor" id="permutation_absorb"></a>
Absorbing data into the permutation state</h1>
<p>Modes that use ASCON typically start by absorbing an initialization vector value into the state and then calling the permutation. The following is the initialization sequence for the ASCON-HASHA algorithm:</p>
 <div class="fragment"><div class="line">    <a class="code" href="unionascon__state__t.html">ascon_state_t</a> <a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>;</div>
<div class="line">    <a class="code" href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940">ascon_init</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span> iv[8] = {</div>
<div class="line">        0x00, 0x40, 0x0c, 0x04, 0x00, 0x00, 0x01, 0x00</div>
<div class="line">    };</div>
<div class="line">    <a class="code" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111">ascon_overwrite_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, iv, 0, 8);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a132695890e3130dd42ba6eaf3f545aec">ascon_permute12</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="ttc" id="apermutation_8h_html_a132695890e3130dd42ba6eaf3f545aec"><div class="ttname"><a href="permutation_8h.html#a132695890e3130dd42ba6eaf3f545aec">ascon_permute12</a></div><div class="ttdeci">#define ascon_permute12(state)</div><div class="ttdoc">Permutes the ASCON state with 12 rounds of the permutation.</div><div class="ttdef"><b>Definition:</b> <a href="permutation_8h_source.html#l00199">permutation.h:199</a></div></div>
<div class="ttc" id="apermutation_8h_html_a63ccf2f2c9304de42a07db57fa77f111"><div class="ttname"><a href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111">ascon_overwrite_bytes</a></div><div class="ttdeci">void ascon_overwrite_bytes(ascon_state_t *state, const uint8_t *data, unsigned offset, unsigned size)</div><div class="ttdoc">Overwrites existing bytes in the ASCON state.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00084">ascon-sliced32.c:85</a></div></div>
</div><!-- fragment --><p> We can use either <a class="el" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad" title="Adds bytes to the ASCON state by XOR&#39;ing them with existing bytes.">ascon_add_bytes()</a> or <a class="el" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111" title="Overwrites existing bytes in the ASCON state.">ascon_overwrite_bytes()</a> to absorb the initialization vector; <a class="el" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111" title="Overwrites existing bytes in the ASCON state.">ascon_overwrite_bytes()</a> is slightly faster for this use case because we know that <a class="el" href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940" title="Initializes the words of the ASCON permutation state to zero.">ascon_init()</a> set the state to all-zeroes.</p>
<p>ASCON-HASHA absorbs the incoming data in blocks of 8 bytes in length, invoking the permutation for 8 rounds between each block:</p>
 <div class="fragment"><div class="line">    <span class="keywordflow">for</span> (posn = 0; (posn + 8) &lt;= len; posn += 8) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <a class="code" href="snippets_8c.html#a452197b783e2154bfb867fe34c4e7067">data</a> + posn, 0, 8);</div>
<div class="line">        <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    }</div>
<div class="ttc" id="apermutation_8h_html_a9f8aac2e179991e4109fc6846cf475ad"><div class="ttname"><a href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a></div><div class="ttdeci">void ascon_add_bytes(ascon_state_t *state, const uint8_t *data, unsigned offset, unsigned size)</div><div class="ttdoc">Adds bytes to the ASCON state by XOR'ing them with existing bytes.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00050">ascon-sliced32.c:51</a></div></div>
<div class="ttc" id="apermutation_8h_html_ae569b026a158b727a6f3a6148266c2af"><div class="ttname"><a href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a></div><div class="ttdeci">#define ascon_permute8(state)</div><div class="ttdoc">Permutes the ASCON state with 8 rounds of the permutation.</div><div class="ttdef"><b>Definition:</b> <a href="permutation_8h_source.html#l00206">permutation.h:206</a></div></div>
<div class="ttc" id="asnippets_8c_html_a452197b783e2154bfb867fe34c4e7067"><div class="ttname"><a href="snippets_8c.html#a452197b783e2154bfb867fe34c4e7067">data</a></div><div class="ttdeci">unsigned char data[8]</div><div class="ttdoc">[snippet_key]</div><div class="ttdef"><b>Definition:</b> <a href="snippets_8c_source.html#l00014">snippets.c:14</a></div></div>
</div><!-- fragment --><p> The last partial input block is padded with a 0x80 byte and then the permutation is run for a full 12 rounds:</p>
 <div class="fragment"><div class="line">    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span> pad[1] = {0x80};</div>
<div class="line">    <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <a class="code" href="snippets_8c.html#a452197b783e2154bfb867fe34c4e7067">data</a> + posn, 0, len - posn);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, pad, len - posn, 1);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a132695890e3130dd42ba6eaf3f545aec">ascon_permute12</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
</div><!-- fragment --><p> PRNG algorithms based on a sponge function protect themselves from being run backwards by extracting some data and XOR'ing it back into the state to zero out those bytes. The state is protected from being run backwards because an attacker would need to guess the bytes before they were zeroed:</p>
<div class="fragment"><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="snippets_8c.html#a452197b783e2154bfb867fe34c4e7067">data</a>[8];</div>
<div class="line">    <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <a class="code" href="snippets_8c.html#a452197b783e2154bfb867fe34c4e7067">data</a>, 0, 8);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <a class="code" href="snippets_8c.html#a452197b783e2154bfb867fe34c4e7067">data</a>, 0, 8);</div>
<div class="line">    <a class="code" href="utility_8h.html#a331ff039487fd153ee170a600cf4850b">ascon_clean</a>(<a class="code" href="snippets_8c.html#a452197b783e2154bfb867fe34c4e7067">data</a>, <span class="keyword">sizeof</span>(<a class="code" href="snippets_8c.html#a452197b783e2154bfb867fe34c4e7067">data</a>));</div>
<div class="ttc" id="apermutation_8h_html_a87a4d252e365571cb22856cf5dd7ae15"><div class="ttname"><a href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a></div><div class="ttdeci">void ascon_extract_bytes(const ascon_state_t *state, uint8_t *data, unsigned offset, unsigned size)</div><div class="ttdoc">Extracts bytes from the ASCON state.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00150">ascon-sliced32.c:151</a></div></div>
<div class="ttc" id="autility_8h_html_a331ff039487fd153ee170a600cf4850b"><div class="ttname"><a href="utility_8h.html#a331ff039487fd153ee170a600cf4850b">ascon_clean</a></div><div class="ttdeci">void ascon_clean(void *buf, unsigned size)</div><div class="ttdoc">Cleans a buffer that contains sensitive material.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-clean_8c_source.html#l00038">ascon-clean.c:38</a></div></div>
</div><!-- fragment --><p> A more efficient method that doesn't need a temporary buffer is to use the function <a class="el" href="permutation_8h.html#a22a8214c2070349fb072f7c8fd751ace" title="Overwrites a part of the ASCON state with zeroes.">ascon_overwrite_with_zeroes()</a> instead:</p>
<div class="fragment"><div class="line">    <a class="code" href="permutation_8h.html#a22a8214c2070349fb072f7c8fd751ace">ascon_overwrite_with_zeroes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, 0, 8);</div>
<div class="ttc" id="apermutation_8h_html_a22a8214c2070349fb072f7c8fd751ace"><div class="ttname"><a href="permutation_8h.html#a22a8214c2070349fb072f7c8fd751ace">ascon_overwrite_with_zeroes</a></div><div class="ttdeci">void ascon_overwrite_with_zeroes(ascon_state_t *state, unsigned offset, unsigned size)</div><div class="ttdoc">Overwrites a part of the ASCON state with zeroes.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00121">ascon-sliced32.c:122</a></div></div>
</div><!-- fragment --> <h1><a class="anchor" id="permutation_squeeze"></a>
Squeezing data out of the permutation state</h1>
<p>ASCON-HASHA extracts 32 bytes from the permutation state for the hash value, 8 bytes at a time. This is done with the <a class="el" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15" title="Extracts bytes from the ASCON state.">ascon_extract_bytes()</a> function:</p>
 <div class="fragment"><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hash[32];</div>
<div class="line">    <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, hash, 0, 8);</div>
<div class="line">    <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, hash + 8, 0, 8);</div>
<div class="line">    <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, hash + 16, 0, 8);</div>
<div class="line">    <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, hash + 24, 0, 8);</div>
</div><!-- fragment --><p> <a class="el" href="permutation_2hash_2main_8c-example.html">Full source code for the hashing example</a></p>
<h1><a class="anchor" id="permutation_encrypt"></a>
Encrypting and decrypting with a permutation state</h1>
<p>If we were implementing an encryption mode, we would start by absorbing the 16-byte key and the 16-byte nonce after the initialization vector, but before the permutation call:</p>
<div class="fragment"><div class="line">    <a class="code" href="unionascon__state__t.html">ascon_state_t</a> <a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>;</div>
<div class="line">    <a class="code" href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940">ascon_init</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span> iv[8] = {</div>
<div class="line">        0x80, 0x40, 0x0c, 0x06, 0xFF, 0xFF, 0xFF, 0xFF</div>
<div class="line">    };</div>
<div class="line">    <a class="code" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111">ascon_overwrite_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, iv, 0, 8);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111">ascon_overwrite_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, key, 8, 16);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111">ascon_overwrite_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, nonce, 24, 16);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a132695890e3130dd42ba6eaf3f545aec">ascon_permute12</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
</div><!-- fragment --><p> There are many ways to encrypt using a permutation like ASCON. The library contains several for AEAD modes. We will explore two methods, loosely based on the Output FeedBack (OFB) and Cipher FeedBack (CFB) modes for block ciphers.</p>
<p>In OFB mode, the permutation is iterated and extracted output is XOR'ed with the plaintext m to produce the ciphertext c:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="snippets_8c.html#af47bfdfe8f1f74d539d5135573286487">ofb_encrypt</a>(<a class="code" href="unionascon__state__t.html">ascon_state_t</a> *<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *c, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *m, <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> posn;</div>
<div class="line">    <span class="keywordflow">for</span> (posn = 0; (posn + 16) &lt;= len; posn += 16) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#aa12b0230d53426eb2111b58431487e13">ascon_extract_and_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, m + posn, c + posn, 0, 16);</div>
<div class="line">        <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (posn &lt; len) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#aa12b0230d53426eb2111b58431487e13">ascon_extract_and_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, m + posn, c + posn, 0, len - posn);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="apermutation_8h_html_aa12b0230d53426eb2111b58431487e13"><div class="ttname"><a href="permutation_8h.html#aa12b0230d53426eb2111b58431487e13">ascon_extract_and_add_bytes</a></div><div class="ttdeci">void ascon_extract_and_add_bytes(const ascon_state_t *state, const uint8_t *input, uint8_t *output, unsigned offset, unsigned size)</div><div class="ttdoc">Extracts bytes from the ASCON state and XOR's them with input bytes to produce output bytes.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00182">ascon-sliced32.c:183</a></div></div>
<div class="ttc" id="asnippets_8c_html_af47bfdfe8f1f74d539d5135573286487"><div class="ttname"><a href="snippets_8c.html#af47bfdfe8f1f74d539d5135573286487">ofb_encrypt</a></div><div class="ttdeci">void ofb_encrypt(ascon_state_t *state, unsigned char *c, const unsigned char *m, int len)</div><div class="ttdoc">[snippet_zero2]</div><div class="ttdef"><b>Definition:</b> <a href="snippets_8c_source.html#l00025">snippets.c:25</a></div></div>
</div><!-- fragment --><p> The <a class="el" href="permutation_8h.html#aa12b0230d53426eb2111b58431487e13" title="Extracts bytes from the ASCON state and XOR&#39;s them with input bytes to produce output bytes.">ascon_extract_and_add_bytes()</a> function extracts bytes from the permutation state and XOR's them with the input buffer in its second argument to produce the bytes in the output buffer in its third argument. The permutation state itself is unmodified.</p>
<p>The OFB encryption function can also be used for decryption by swapping the m and c arguments. It is its own inverse.</p>
<p>In CFB mode, we incorporate the plaintext into the state. Future blocks depend not only on the permutation state but also all of the plaintext to date. This is a common construction for ciphers when we want authenticate the plaintext in addition to encrypting it:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="snippets_8c.html#aaa499a705756193fc7f817021d20393e">cfb_encrypt</a>(<a class="code" href="unionascon__state__t.html">ascon_state_t</a> *<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *c, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *m, <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> posn;</div>
<div class="line">    <span class="keywordflow">for</span> (posn = 0; (posn + 16) &lt;= len; posn += 16) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, m + posn, 0, 16);</div>
<div class="line">        <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, c + posn, 0, 16);</div>
<div class="line">        <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (posn &lt; len) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, m + posn, 0, len - posn);</div>
<div class="line">        <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, c + posn, 0, len - posn);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="asnippets_8c_html_aaa499a705756193fc7f817021d20393e"><div class="ttname"><a href="snippets_8c.html#aaa499a705756193fc7f817021d20393e">cfb_encrypt</a></div><div class="ttdeci">void cfb_encrypt(ascon_state_t *state, unsigned char *c, const unsigned char *m, int len)</div><div class="ttdoc">[snippet_encrypt_ofb]</div><div class="ttdef"><b>Definition:</b> <a href="snippets_8c_source.html#l00039">snippets.c:39</a></div></div>
</div><!-- fragment --><p> The <a class="el" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad" title="Adds bytes to the ASCON state by XOR&#39;ing them with existing bytes.">ascon_add_bytes()</a> call XOR's the plaintext block with the state to encrypt it and incorporate it into the state. The <a class="el" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15" title="Extracts bytes from the ASCON state.">ascon_extract_bytes()</a> call pulls out the encrypted data.</p>
<p>CFB decryption has a slightly different structure to encryption:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="snippets_8c.html#a2adc8bf1629705c9b1ea847d6375ecd0">cfb_decrypt</a>(<a class="code" href="unionascon__state__t.html">ascon_state_t</a> *<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *m, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *c, <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> posn;</div>
<div class="line">    <span class="keywordflow">for</span> (posn = 0; (posn + 16) &lt;= len; posn += 16) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#aa12b0230d53426eb2111b58431487e13">ascon_extract_and_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, m + posn, c + posn, 0, 16);</div>
<div class="line">        <a class="code" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111">ascon_overwrite_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, c + posn, 0, 16);</div>
<div class="line">        <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (posn &lt; len) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#aa12b0230d53426eb2111b58431487e13">ascon_extract_and_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, m + posn, c + posn, 0, len - posn);</div>
<div class="line">        <a class="code" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111">ascon_overwrite_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, c + posn, 0, len - posn);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="asnippets_8c_html_a2adc8bf1629705c9b1ea847d6375ecd0"><div class="ttname"><a href="snippets_8c.html#a2adc8bf1629705c9b1ea847d6375ecd0">cfb_decrypt</a></div><div class="ttdeci">void cfb_decrypt(ascon_state_t *state, unsigned char *m, const unsigned char *c, int len)</div><div class="ttdoc">[snippet_encrypt_cfb]</div><div class="ttdef"><b>Definition:</b> <a href="snippets_8c_source.html#l00055">snippets.c:55</a></div></div>
</div><!-- fragment --><p> The <a class="el" href="permutation_8h.html#aa12b0230d53426eb2111b58431487e13" title="Extracts bytes from the ASCON state and XOR&#39;s them with input bytes to produce output bytes.">ascon_extract_and_add_bytes()</a> call extracts some of the state and XOR's it with the ciphertext block to decrypt it. The original ciphertext block is then incorporated into the state for the next step.</p>
<p>There is a problem with this code however. This will not work if m and c are the same buffer for in-place decryption. We could save the ciphertext block in a temporary location before the call to <a class="el" href="permutation_8h.html#aa12b0230d53426eb2111b58431487e13" title="Extracts bytes from the ASCON state and XOR&#39;s them with input bytes to produce output bytes.">ascon_extract_and_add_bytes()</a>. A more efficient method is to use <a class="el" href="permutation_8h.html#a89490f5d8f6894d3324fa74738f02bf5" title="Extracts bytes from the ASCON state and XOR&#39;s them with input bytes to produce output bytes....">ascon_extract_and_overwrite_bytes()</a>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="snippets_8c.html#a2adc8bf1629705c9b1ea847d6375ecd0">cfb_decrypt</a>(<a class="code" href="unionascon__state__t.html">ascon_state_t</a> *<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *m, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *c, <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> posn;</div>
<div class="line">    <span class="keywordflow">for</span> (posn = 0; (posn + 16) &lt;= len; posn += 16) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#a89490f5d8f6894d3324fa74738f02bf5">ascon_extract_and_overwrite_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, c + posn, m + posn, 0, 16);</div>
<div class="line">        <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (posn &lt; len) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#a89490f5d8f6894d3324fa74738f02bf5">ascon_extract_and_overwrite_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, c + posn, m + posn, 0, len - posn);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="apermutation_8h_html_a89490f5d8f6894d3324fa74738f02bf5"><div class="ttname"><a href="permutation_8h.html#a89490f5d8f6894d3324fa74738f02bf5">ascon_extract_and_overwrite_bytes</a></div><div class="ttdeci">void ascon_extract_and_overwrite_bytes(ascon_state_t *state, const uint8_t *input, uint8_t *output, unsigned offset, unsigned size)</div><div class="ttdoc">Extracts bytes from the ASCON state and XOR's them with input bytes to produce output bytes....</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00217">ascon-sliced32.c:218</a></div></div>
</div><!-- fragment --><p> If we were building an authenticated cipher based around CFB mode, we would next extract some bytes from the permutation state to act as the authentication tag:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="snippets_8c.html#a2dacf6402686c97c6bcacaf3763d4697">cfb_auth_encrypt</a>(<a class="code" href="unionascon__state__t.html">ascon_state_t</a> *<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *c, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *m, <span class="keywordtype">int</span> len, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tag[16])</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span> pad[1] = {0x80};</div>
<div class="line">    <span class="keywordtype">int</span> posn;</div>
<div class="line">    <span class="keywordflow">for</span> (posn = 0; (posn + 16) &lt;= len; posn += 16) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, m + posn, 0, 16);</div>
<div class="line">        <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, c + posn, 0, 16);</div>
<div class="line">        <a class="code" href="permutation_8h.html#ae569b026a158b727a6f3a6148266c2af">ascon_permute8</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (posn &lt; len) {</div>
<div class="line">        <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, m + posn, 0, len - posn);</div>
<div class="line">        <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, c + posn, 0, len - posn);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="permutation_8h.html#a9f8aac2e179991e4109fc6846cf475ad">ascon_add_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, pad, len - posn, 1); <span class="comment">/* padding */</span></div>
<div class="line">    <a class="code" href="permutation_8h.html#a132695890e3130dd42ba6eaf3f545aec">ascon_permute12</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line">    <a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, tag, 24, 16); <span class="comment">/* extract the tag */</span></div>
<div class="line">}</div>
<div class="ttc" id="asnippets_8c_html_a2dacf6402686c97c6bcacaf3763d4697"><div class="ttname"><a href="snippets_8c.html#a2dacf6402686c97c6bcacaf3763d4697">cfb_auth_encrypt</a></div><div class="ttdeci">void cfb_auth_encrypt(ascon_state_t *state, unsigned char *c, const unsigned char *m, int len, unsigned char tag[16])</div><div class="ttdoc">[snippet_decrypt_cfb2]</div><div class="ttdef"><b>Definition:</b> <a href="snippets_8c_source.html#l00085">snippets.c:85</a></div></div>
</div><!-- fragment --><p> <a class="el" href="permutation_2encrypt_2main_8c-example.html">Full source code for the CFB encryption example</a></p>
<h1><a class="anchor" id="permutation_suspend"></a>
Suspending use of the permutation</h1>
<p>Normally you initialize the ASCON state, perform the add or extract operations you need, and then free the state in a single sequence. Combined high-level functions in the API like <a class="el" href="hash_8h.html#a9cad2fdcda9b13b1b44d32996b5da271" title="Hashes a block of input data with ASCON-HASH.">ascon_hash()</a> and <a class="el" href="ascon-aead-128_8c.html#ac90f24f2a15f4a1ee6b1ef8bb302ce47" title="Encrypts and authenticates a packet with ASCON-128.">ascon128_aead_encrypt()</a> do this.</p>
<p>For incremental API's, there may be an unknown amount of time between uses of the permutation. Incremental functions like <a class="el" href="hash_8h.html#a5fc41e4ccd0f2633fdddf3667e4b0894" title="Updates an ASCON-HASH state with more input data.">ascon_hash_update()</a> and <a class="el" href="xof_8h.html#ad0df1adce85652cbaac500e5f56e317a" title="Squeezes output data from an ASCON-XOF state.">ascon_xof_squeeze()</a> do this.</p>
<p>If the backend is using a shared accelerated hardware module then you don't want to keep it tied up indefinitely. Other tasks on the system may want to use it.</p>
<p>The appropriate thing to do is to call <a class="el" href="permutation_8h.html#a410f8e67594d361c5a66a9d26e0d0394" title="Temporarily releases access to any shared hardware resources that a permutation state was using.">ascon_release()</a> to return the hardware module to the system, and then call <a class="el" href="permutation_8h.html#acddaed54982b66adaf1aece3b38d3be4" title="Re-acquires access to any shared hardware resources that a permutation state was using.">ascon_acquire()</a> when you want to resume using ASCON:</p>
<div class="fragment"><div class="line"><a class="code" href="unionascon__state__t.html">ascon_state_t</a> <a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>;</div>
<div class="line"><a class="code" href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940">ascon_init</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// perform some operations with the state</span></div>
<div class="line">...;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="permutation_8h.html#a410f8e67594d361c5a66a9d26e0d0394">ascon_release</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// go off and do something else</span></div>
<div class="line">...;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="permutation_8h.html#acddaed54982b66adaf1aece3b38d3be4">ascon_acquire</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// continue using the state</span></div>
<div class="line">...;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="permutation_8h.html#a3331b7366f81091a2182f215cf7fef1c">ascon_free</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="ttc" id="apermutation_8h_html_a410f8e67594d361c5a66a9d26e0d0394"><div class="ttname"><a href="permutation_8h.html#a410f8e67594d361c5a66a9d26e0d0394">ascon_release</a></div><div class="ttdeci">void ascon_release(ascon_state_t *state)</div><div class="ttdoc">Temporarily releases access to any shared hardware resources that a permutation state was using.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00261">ascon-sliced32.c:261</a></div></div>
<div class="ttc" id="apermutation_8h_html_acddaed54982b66adaf1aece3b38d3be4"><div class="ttname"><a href="permutation_8h.html#acddaed54982b66adaf1aece3b38d3be4">ascon_acquire</a></div><div class="ttdeci">void ascon_acquire(ascon_state_t *state)</div><div class="ttdoc">Re-acquires access to any shared hardware resources that a permutation state was using.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00267">ascon-sliced32.c:267</a></div></div>
</div><!-- fragment --><p>The ASCON state is implicitly acquired when <a class="el" href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940" title="Initializes the words of the ASCON permutation state to zero.">ascon_init()</a> is called and implicitly released when <a class="el" href="permutation_8h.html#a3331b7366f81091a2182f215cf7fef1c" title="Frees an ASCON permutation state and attempts to destroy any sensitive material.">ascon_free()</a> is called. The <a class="el" href="permutation_8h.html#a410f8e67594d361c5a66a9d26e0d0394" title="Temporarily releases access to any shared hardware resources that a permutation state was using.">ascon_release()</a> and <a class="el" href="permutation_8h.html#acddaed54982b66adaf1aece3b38d3be4" title="Re-acquires access to any shared hardware resources that a permutation state was using.">ascon_acquire()</a> functions are not recursive and do not "count" how many acquisitions are in effect by the current task. The behaviour is undefined if they are called in the wrong order.</p>
<p>Incremental API's in the library release and acquire the state automatically so you don't have to do anything if you are using the library's modes.</p>
<h1><a class="anchor" id="permutation_copy"></a>
Copying the permutation state</h1>
<p>Sometimes you may want to copy the entire state of the permutation to a new object. The ISAP mode in the library makes use of this. The ISAP key state is precomputed ahead of time. When a message is encrypted, the per-message state is initialized by copying the precomputed state.</p>
<div class="fragment"><div class="line"><a class="code" href="unionascon__state__t.html">ascon_state_t</a> precomputed;</div>
<div class="line"><a class="code" href="unionascon__state__t.html">ascon_state_t</a> copy;</div>
<div class="line">...;</div>
<div class="line"><a class="code" href="permutation_8h.html#a6eb6f001b208ee4f5bacf31c5e46f0b5">ascon_copy</a>(&amp;copy, &amp;precomputed);</div>
<div class="ttc" id="apermutation_8h_html_a6eb6f001b208ee4f5bacf31c5e46f0b5"><div class="ttname"><a href="permutation_8h.html#a6eb6f001b208ee4f5bacf31c5e46f0b5">ascon_copy</a></div><div class="ttdeci">void ascon_copy(ascon_state_t *dest, const ascon_state_t *src)</div><div class="ttdoc">Copies the entire ASCON permutation state from a source to a destination.</div><div class="ttdef"><b>Definition:</b> <a href="ascon-sliced32_8c_source.html#l00273">ascon-sliced32.c:273</a></div></div>
</div><!-- fragment --><p>It is important that the "precomputed" state be released. The copy process will create a brand new state in "copy" and acquire it.</p>
<h1><a class="anchor" id="permutation_rep"></a>
State representation</h1>
<p>The current backends store the 320 bits of the ASCON state directly in the <a class="el" href="unionascon__state__t.html" title="Structure of the internal state of the ASCON permutation.">ascon_state_t</a> structure. But this may not be the case in the future. Accelerated backends may need more memory than 320 bits, or need handles to access secure hardware modules. Thus, some versions of <a class="el" href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940" title="Initializes the words of the ASCON permutation state to zero.">ascon_init()</a> may allocate memory from the heap and store a pointer into the <a class="el" href="unionascon__state__t.html" title="Structure of the internal state of the ASCON permutation.">ascon_state_t</a> structure. The memory is freed when <a class="el" href="permutation_8h.html#a3331b7366f81091a2182f215cf7fef1c" title="Frees an ASCON permutation state and attempts to destroy any sensitive material.">ascon_free()</a> is called.</p>
<p>It is very important that the contents of <a class="el" href="unionascon__state__t.html" title="Structure of the internal state of the ASCON permutation.">ascon_state_t</a> be treated as opaque. You may be tempted to directly XOR your data with the state, but it won't work. Even with the current backends, the 320 bits are not guaranteed to be stored in the canonical ASCON bit order.</p>
<p>For efficiency reasons, the backend is allowed to store the bits of the state in any order it wishes. Some use the canonical order (e.g. avr5), others use little-endian 64-bit words (e.g. x86-64 and armv8a), and still others use a 32-bit bit-sliced representation where the even and odd bits of the state are split into separate words (e.g. armv6, armv7m, i386, m68k, etc).</p>
<p>There is no method outside of the library to detect which bit order is being used. Applications should use the "add", "overwrite", and "extract" functions in the SnP API to manipulate the permutation state. This design choice simplifies the public permutation API and the applications that use it.</p>
<p>The modes that are implemented inside the library are aware of which backend is in use and can optimize "add", "overwrite", and "extract" operations accordingly. This is why it is usually better to use the library's modes than invent your own.</p>
<p>Use <a class="el" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15" title="Extracts bytes from the ASCON state.">ascon_extract_bytes()</a> with a 40-byte buffer if you want to extract the entire ASCON state in the canonical bit order. And use <a class="el" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111" title="Overwrites existing bytes in the ASCON state.">ascon_overwrite_bytes()</a> to populate the entire ASCON state from a 40-byte buffer in the canonical bit order. The following example permutes a test vector with 6 rounds of the permutation:</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> test_vector[40] = {</div>
<div class="line">    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,</div>
<div class="line">    0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,</div>
<div class="line">    0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,</div>
<div class="line">    0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,</div>
<div class="line">    0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27</div>
<div class="line">};</div>
<div class="line"><a class="code" href="unionascon__state__t.html">ascon_state_t</a> <a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>;</div>
<div class="line"><a class="code" href="permutation_8h.html#adafef02af51e197bc78bba4b4222e940">ascon_init</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line"><a class="code" href="permutation_8h.html#a63ccf2f2c9304de42a07db57fa77f111">ascon_overwrite_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, test_vector, 40);</div>
<div class="line"><a class="code" href="permutation_8h.html#adea77da266b81944a3fb25826ac08dd6">ascon_permute6</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="line"><a class="code" href="permutation_8h.html#a87a4d252e365571cb22856cf5dd7ae15">ascon_extract_bytes</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>, test_vector, 40);</div>
<div class="line"><a class="code" href="permutation_8h.html#a3331b7366f81091a2182f215cf7fef1c">ascon_free</a>(&amp;<a class="code" href="snippets_8c.html#a11a12bb758476a291d682dac7046a3f4">state</a>);</div>
<div class="ttc" id="apermutation_8h_html_adea77da266b81944a3fb25826ac08dd6"><div class="ttname"><a href="permutation_8h.html#adea77da266b81944a3fb25826ac08dd6">ascon_permute6</a></div><div class="ttdeci">#define ascon_permute6(state)</div><div class="ttdoc">Permutes the ASCON state with 6 rounds of the permutation.</div><div class="ttdef"><b>Definition:</b> <a href="permutation_8h_source.html#l00213">permutation.h:213</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Mar 19 2023 13:56:57 for ASCON Suite by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
