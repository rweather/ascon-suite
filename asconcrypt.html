<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASCON Suite: Encrypting and decrypting files with ASCONcrypt</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASCON Suite
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Encrypting and decrypting files with ASCONcrypt </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#asconcrypt_using">Using ASCONcrypt</a></li>
<li class="level1"><a href="#asconcrypt_file_format">ASCONcrypt file format</a></li>
</ul>
</div>
<div class="textblock"><p>The <code>asconcrypt</code> program in the <code>apps</code> directory demonstrates how to use ASCON-80pq, ASCON-80pq-SIV, and ASCON-PBKDF2 to create a password-based file encryption and decryption utility. The incremental version of ASCON-80pq is used, which permits large files up to 1 terabyte in size to be encrypted.</p>
<p>ASCONcrypt is inspired <a href="https://www.aescrypt.com/">AES Crypt</a> which provides a simple password-based file encryption method using AES-256 in CBC mode. The file format for ASCONcrypt and the differences with AES Crypt are described below.</p>
<p>The program is installed by "make install" as part of the library build.</p>
<h1><a class="anchor" id="asconcrypt_using"></a>
Using ASCONcrypt</h1>
<p>Files are encrypted by passing them directly to the <code>asconcrypt</code> program. If the system supports it, the user will be prompted for a password and the file is then encrypted into a file with the ".ascon" file extension:</p>
<pre class="fragment">$ ls
MySecretDocument.txt
$ asconcrypt MySecretDocument.txt
Password:
Confirm Password:
$ ls
MySecretDocument.txt.ascon MySecretDocument.txt
</pre><p>The password can also be supplied on the command-line or in a "key file":</p>
<pre class="fragment">$ asconcrypt -p Hello MySecretDocument.txt
$ asconcrypt -k key MySecretDocument.txt
</pre><p>Decrypting a file whose name ends in ".ascon" is similar:</p>
<pre class="fragment">$ ls
MySecretDocument.txt.ascon
$ asconcrypt MySecretDocument.txt.ascon
Password:
$ ls
MySecretDocument.txt.ascon MySecretDocument.txt
</pre><p>In the examples above, the <code>asconcrypt</code> command is able to detect whether to encrypt or decrypt based on the file extension. If the file extension is not clear, then use the "-e" or "-d" options to clarify whether encryption or decryption is required. The "-o" option can also be used to specify an explicit output file:</p>
<pre class="fragment">$ asconcrypt -d -o MySecretDocument.txt -p Hello MySecretDocument.bin
</pre><p>Key files consist of a single line of text with the password, so they are easy to create:</p>
<pre class="fragment">$ echo "This is a long password!" &gt;key
$ asconcrypt -k key MySecretDocument.txt
</pre><p>The <code>asconcrypt</code> program can also generate a random 40 character password for you using the "-g" (generate) option:</p>
<pre class="fragment">$ asconcrypt -g key
$ asconcrypt -k key MySecretDocument.txt
$ cat key
JqEm5mqJUt9mA0wvT3yaoR00knLNVXGD8cwEEpyk
</pre><p><a class="el" href="asconcrypt_2asconcrypt_8c-example.html">Source code for the asconcrypt program</a> </p>
<h1><a class="anchor" id="asconcrypt_file_format"></a>
ASCONcrypt file format</h1>
<p>The ASCONcrypt file format was inspired in part by <a href="https://www.aescrypt.com/">AES Crypt</a>. That format has several sections of interest:</p>
<ul>
<li>Identification string and version for the file format. </li>
<li>Metadata extension blocks in plaintext. </li>
<li>Random initialization vector (essentially a salt). </li>
<li>Key and IV for AES-CBC, encrypted under the password and salt. </li>
<li>HMAC value to validate the encrypted key and IV. </li>
<li>File contents, encrypted with AES-CBC. </li>
<li>HMAC value for the encrypted file contents.</li>
</ul>
<p>ASCONcrypt files contain the following sections:</p>
<ul>
<li>10 bytes containing the characters "ASCONcrypt". </li>
<li>2 bytes containing the 16-bit version number in big endian format. For the current version of the format, this should be 0x0001. </li>
<li>16 byte salt value, allocated randomly. </li>
<li>52 byte "SIV block" as described below. </li>
<li>File contents, encrypted with ASCON-80pq as described below. </li>
<li>16 byte authentication tag computed over the encrypted file contents.</li>
</ul>
<p>The size of the input file will increase by 96 bytes when it is encrypted.</p>
<p>We don't support plaintext metadata in this format. It makes the decryption process complicated to skip arbitrary-sized metadata blocks. The only metadata item that "AES Crypt" seemed to support was a "CREATED_BY" tag for the name and version of the encryption software.</p>
<p>If metadata is important, then it should be placed into the encrypted payload or distributed separately.</p>
<p>The "SIV block" contains the key and nonce, encrypted with the password and salt. The block is formed as follows:</p>
<ul>
<li>Let (k1,n1) be the first 36 bytes of output from <code>ASCON-PBKDF2(password, salt, 8192)</code> where k1 is 20 bytes in length and n1 is 16 bytes in length. </li>
<li>Generate the 36 byte sequence (k2,n2) randomly. Once again, k2 is 20 bytes in length and n2 is 16 bytes in length. </li>
<li>Encrypt the sequence (k2,n2) with ASCON-80pq-SIV using the key k1 and the nonce n1. The associated data is everything from the first byte of the file to the last byte of the salt. </li>
<li>The 52 byte output of ASCON-80pq-SIV (encrypted data plus tag) is written to the "SIV block" section in the output file.</li>
</ul>
<p>The file's contents are encrypted with ASCON-80pq using the key k2 and the nonce n2. The associated data is the 52 bytes of the SIV block.</p>
<p>The SIV block "wraps" the actual encryption key and nonce. When the file is decrypted, the 16 byte authentication tag on the SIV block can be used to verify that the password is correct before attempting to decrypt the rest of the file.</p>
<p>The ASCON specification indicates that no more than 2<sup>67</sup> bytes of data should be encrypted under the same key with ASCON-80pq. For safety, the encryption process is aborted if more than 2<sup>40</sup> bytes or 1 terabyte are encountered. Larger files will need to be split into smaller sections. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Feb 11 2023 09:01:58 for ASCON Suite by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
